<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PRASHAST Pre-Assessment Tool - Complete Mapping</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .assessment-item {
            transition: all 0.3s ease;
        }
        .assessment-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .section-header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
        }
        .progress-bar {
            transition: width 0.5s ease;
        }
        .form-section {
            border-left: 4px solid #4f46e5;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="gradient-bg text-white py-6 shadow-lg">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <i class="fas fa-user-md text-3xl"></i>
                    <div>
                        <h1 class="text-3xl font-bold">PRASHAST Pre-Assessment Tool</h1>
                        <p class="text-blue-100">Comprehensive Disability Assessment Framework</p>
                    </div>
                </div>
                <div class="text-right">
                    <p class="text-sm">CITTAA Health Services</p>
                    <p class="text-xs text-blue-100">Complete Assessment Mapping</p>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="bg-white shadow-sm border-b">
        <div class="container mx-auto px-4 py-3">
            <div class="flex justify-between items-center mb-2">
                <span class="text-sm font-medium text-gray-700">Assessment Progress</span>
                <span class="text-sm text-gray-600"><span id="progress-count">0</span>/85 items completed</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2">
                <div id="progress-bar" class="progress-bar bg-gradient-to-r from-blue-500 to-purple-600 h-2 rounded-full" style="width: 0%"></div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container mx-auto px-4 py-8">
        <form id="prashast-form" class="space-y-8">
            <!-- Student Information Section -->
            <div class="bg-white rounded-xl shadow-lg p-6 form-section">
                <div class="section-header text-white p-4 rounded-t-lg -mx-6 -mt-6 mb-6">
                    <h2 class="text-2xl font-bold flex items-center">
                        <i class="fas fa-user-circle mr-3"></i>
                        Student Information
                    </h2>
                    <p class="text-blue-100 mt-1">Complete all student details below</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Student Name *</label>
                        <input type="text" id="student-name" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Class *</label>
                        <input type="text" id="student-class" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Section *</label>
                        <input type="text" id="student-section" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Age *</label>
                        <input type="number" id="student-age" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Gender *</label>
                        <select id="student-gender" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">Select Gender</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">School *</label>
                        <input type="text" id="student-school" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">State *</label>
                        <input type="text" id="student-state" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Mother's Name</label>
                        <input type="text" id="mother-name" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Father's Name</label>
                        <input type="text" id="father-name" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Height (cm)</label>
                        <input type="number" id="student-height" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Weight (kg)</label>
                        <input type="number" id="student-weight" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                </div>
            </div>

            <!-- Part 1: Disability Assessment -->
            <div class="bg-white rounded-xl shadow-lg p-6 form-section">
                <div class="section-header text-white p-4 rounded-t-lg -mx-6 -mt-6 mb-6">
                    <h2 class="text-2xl font-bold flex items-center">
                        <i class="fas fa-clipboard-check mr-3"></i>
                        Part 1: Disability Assessment
                    </h2>
                    <p class="text-blue-100 mt-1">Tick (✓) if behavior applies</p>
                </div>

                <div id="part1-assessments" class="space-y-6">
                    <!-- Assessment items will be generated by JavaScript -->
                </div>
            </div>

            <!-- Part 2: Additional Assessment -->
            <div class="bg-white rounded-xl shadow-lg p-6 form-section">
                <div class="section-header text-white p-4 rounded-t-lg -mx-6 -mt-6 mb-6">
                    <h2 class="text-2xl font-bold flex items-center">
                        <i class="fas fa-plus-circle mr-3"></i>
                        Part 2: Additional Assessment
                    </h2>
                    <p class="text-blue-100 mt-1">Supplementary assessment items</p>
                </div>

                <div id="part2-assessments" class="space-y-6">
                    <!-- Assessment items will be generated by JavaScript -->
                </div>
            </div>

            <!-- Assessor Information -->
            <div class="bg-white rounded-xl shadow-lg p-6 form-section">
                <div class="section-header text-white p-4 rounded-t-lg -mx-6 -mt-6 mb-6">
                    <h2 class="text-2xl font-bold flex items-center">
                        <i class="fas fa-user-tie mr-3"></i>
                        Assessor Information
                    </h2>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Assessor Name *</label>
                    <input type="text" id="assessor-name" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
            </div>

            <!-- Submit Section -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="text-center space-y-4">
                    <div class="flex justify-center space-x-4">
                        <button type="button" onclick="saveProgress()" class="px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition duration-200">
                            <i class="fas fa-save mr-2"></i>Save Progress
                        </button>
                        <button type="button" onclick="loadProgress()" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition duration-200">
                            <i class="fas fa-upload mr-2"></i>Load Progress
                        </button>
                        <button type="submit" class="px-8 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg hover:from-green-600 hover:to-green-700 transition duration-200 font-semibold">
                            <i class="fas fa-paper-plane mr-2"></i>Submit Assessment
                        </button>
                    </div>
                    <p class="text-sm text-gray-600">All data will be automatically saved to Google Sheets upon submission</p>
                </div>
            </div>
        </form>
    </div>

    <!-- Loading Modal -->
    <div id="loading-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white p-8 rounded-lg shadow-xl">
            <div class="text-center">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
                <p class="text-lg font-semibold">Submitting Assessment...</p>
            </div>
        </div>
    </div>

    <script>
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxYPA8-sZ2KgMhG02zHlwemoNaYXIJqYE1CSopSTJG213iCGfkQk9FdFZSX9jR8uVXfjg/exec';

        // Complete assessment data mapping
        const assessmentData = {
            part1: {
                'Locomotor Disability (LD)': [
                    { id: '1.1', text: 'This student has difficulty in walking or needs support to walk/climb stairs.' },
                    { id: '1.2', text: 'This student has difficulty in moving/using any part of the body (for example hands for writing, eating, etc.).' },
                    { id: '1.3', text: 'This student has observable deformity such as missing any body parts, say for example hand/finger/leg.' }
                ],
                'Leprosy Cured Person': [
                    { id: '2.1', text: 'This student experiences numbness (feels nothing/lack of sensation) in hand/feet/leg/arm.' }
                ],
                'Cerebral Palsy (CP)': [
                    { id: '3.1', text: 'This student has stiffness/floppiness in limbs and/or jerky movement in limbs/jerky walking pattern/involuntary (uncontrolled) movements.' },
                    { id: '3.2', text: 'This student has problems in self-help skills/defecating/washing/eating/holding and placing objects/cutting/pasting.' },
                    { id: '3.3', text: 'This student has slurred (unclear) speech or drooling.' }
                ],
                'Dwarfism': [
                    { id: '4.1', text: 'This student is significantly shorter for his/her age.' },
                    { id: '4.2', text: 'This student has a disproportionately large head/bowed legs/short fingers/neck.' }
                ],
                'Muscular Dystrophy': [
                    { id: '5.1', text: 'This student falls frequently and has difficulty getting up from a lying or sitting position.' },
                    { id: '5.2', text: 'This student always walks on his/her toes.' }
                ],
                'Acid Attack Victim': [
                    { id: '6.1', text: 'This student is an acid attack survivor.' }
                ],
                'Blindness': [
                    { id: '7.1', text: 'This student is unable to see anything using both eyes.' }
                ],
                'Low Vision (LV)': [
                    { id: '8.1', text: 'This student has difficulty in seeing in low lighting or feels the need to move towards the source of light.' },
                    { id: '8.2', text: 'This student blinks/rubs his/her eyes frequently or complains about burning sensation or itchiness in or around the eyes/frequent headache.' },
                    { id: '8.3', text: 'This student holds a book too far or too close while reading.' },
                    { id: '8.4', text: 'This student faces difficulties while reading such as misplaces the line or skips lines in between, omits words, adds words, moves head along the text.' },
                    { id: '8.5', text: 'This student avoids engaging in activities requiring visual focus such as reading or colouring or writing/copying from blackboard or prefers to copy from peers.' },
                    { id: '8.6', text: 'This student closes or covers one eye while reading or focusing on close objects.' },
                    { id: '8.7', text: 'This student has misaligned eyes (asymmetrical or squint).' }
                ],
                'Hearing Impairment (HI)': [
                    { id: '9.1', text: 'This student turns head to position ear in the direction of the speaker or purposefully watches the face of the speaker during a conversation.' },
                    { id: '9.2', text: 'This student does not respond when addressed or called out.' },
                    { id: '9.3', text: 'This student uses an unusually loud voice while speaking or often mispronounces words.' },
                    { id: '9.4', text: 'This student frequently asks for repetition during dictation or verbal instruction.' },
                    { id: '9.5', text: 'This student has problems in hearing environmental sounds such as the school bell, people calling or is not startled/surprised by loud noises.' }
                ],
                'Speech & Language Disability': [
                    { id: '10.1', text: 'This student repeats words or parts of words or speaks in short, fragmented phrases.' },
                    { id: '10.2', text: 'This student stammers while speaking or speaks incoherently.' }
                ],
                'Intellectual Disability (ID)': [
                    { id: '11.1', text: 'This student has difficulty in communicating or socializing with others.' },
                    { id: '11.2', text: 'This student is unable to do everyday tasks like finishing homework/following instructions/directions of the teacher or even using the washroom without help.' },
                    { id: '11.3', text: "This student's behaviour doesn't conform to the context (playground/classroom/home) or accepted social norms for example, frequently walks out of the class without permission, speaks out of turn and keeps interrupting." },
                    { id: '11.4', text: 'This student has difficulty in applying what is learnt successfully in one situation/context to another (e.g., solving an arithmetic problem on paper but not in a real-life scenario).' }
                ],
                'Specific Learning Disabilities (SLD)': [
                    { id: '12.1', text: 'This student reads or writes slower than the average/expected speed.' },
                    { id: '12.2', text: 'This student has bad handwriting that lacks clarity even after sufficient practice and exercises.' },
                    { id: '12.3', text: 'This student has continuous difficulties in understanding the meaning of what is read.' },
                    { id: '12.4', text: 'This student exhibits difficulty in recalling the spellings of learnt words/grammar/punctuation/organization, even after teaching multiple times.' },
                    { id: '12.5', text: 'This student has a comparatively short attention span or is unable to concentrate on a task.' },
                    { id: '12.6', text: 'This student has difficulty in organizing himself/herself to complete a task on time.' },
                    { id: '12.7', text: 'This student lacks a sense of direction (left-right/up-down/front back).' },
                    { id: '12.8', text: "This student reverses letters or symbols or words or numbers while writing, for example, writing 'q' instead 'p' or b/d, u/v, w/m, frequently." },
                    { id: '12.9', text: 'The errors committed by this student have a particular pattern or consistency.' },
                    { id: '12.10', text: 'This student has difficulty in understanding mathematical symbols such as +, -, x, ÷.' }
                ],
                'Autism Spectrum Disorder (ASD)': [
                    { id: '13.1', text: 'This student has difficulty in making eye contact or looking at the speaker.' },
                    { id: '13.2', text: "This student echoes or repeats words. For example, on being asked 'What is your name?' will repeat 'What is your name?' instead of telling his/her name." },
                    { id: '13.3', text: 'This student frequently engages in repetitive play/actions. For example, spinning, flapping hands, rocking, or lining up objects.' },
                    { id: '13.4', text: 'This student is unusually sensitive to certain sounds/touch/texture/light/smell, or shows little or no reaction to pain or heat or cold.' },
                    { id: '13.5', text: 'This student has strong resistance to changes in routine.' },
                    { id: '13.6', text: 'This student has an unusual attachment to an object (for example holding a toy/pencil/stone/leaf for an unusually long time).' },
                    { id: '13.7', text: 'This student is unaware of danger. For example, walking in the middle of a road/playing with fire.' },
                    { id: '13.8', text: "This student doesn't initiate interaction or prefers to stay alone." }
                ],
                'Mental Illness (MI)': [
                    { id: '14.1', text: 'This student often appears sad, or seems withdrawn, or has severe mood swings that cause problems in relationships at school.' },
                    { id: '14.2', text: 'This student has trouble focusing or sitting still/staying in his/her seat?' },
                    { id: '14.3', text: 'This student has an unexplained weight loss or weight gain?' },
                    { id: '14.4', text: 'This student look anxious and frequently report symptoms such as headaches and stomach aches?' }
                ],
                'Multiple Sclerosis (MS)': [
                    { id: '15.1', text: 'This student has numbness or weakness in limbs that typically occurs on one side of the body at a time or the legs and trunk?' },
                    { id: '15.2', text: 'This student complains about electric shock sensations that occur with certain neck movements?' }
                ],
                "Parkinson's Disease": [
                    { id: '16.1', text: 'This student has cramped and smaller handwriting?' }
                ],
                'Haemophilia': [
                    { id: '17.1', text: 'Does this student have unexplained and excessive bleeding from cuts or injuries?' },
                    { id: '17.2', text: 'Does this student have many large or deep bruises?' },
                    { id: '17.3', text: 'Does this student appear to be very lethargic?' },
                    { id: '17.4', text: 'Does this student complain of a painful and prolonged headache?' },
                    { id: '17.5', text: 'Does this student have a tendency to bleed from the nose, mouth, and gums without a known cause?' }
                ],
                'Thalassemia': [
                    { id: '18.1', text: 'Does this student get easily tired?' },
                    { id: '18.2', text: 'Does this student complain of unusual (out-of proportion) weakness?' },
                    { id: '18.3', text: 'Does this student have pale or yellowish skin?' },
                    { id: '18.4', text: 'Does this student look anaemic or affected with anaemia?' },
                    { id: '18.5', text: 'Does this student complain of the dark colour of the urine?' }
                ],
                'Sickle Cell Disease': [
                    { id: '19.1', text: 'Does this student exhibit unexplained episodes of severe pain?' },
                    { id: '19.2', text: 'Does this student exhibit swelling in the hands or feet most of the time?' }
                ]
            },
            part2: {
                'Mental Illness (MI)': [
                    { id: '14.5', text: '*Does this student indulge in self-harm activities such as making cut marks or burning fingers?' },
                    { id: '14.6', text: '*Has this student been observed to exhibit suicidal thoughts or talk about attempting suicide?' },
                    { id: '14.7', text: 'Has this student been observed getting involved in drugs or alcohol use?' },
                    { id: '14.8', text: 'Does this student have intense fear of something, which, in reality, has little or no actual danger?' },
                    { id: '14.9', text: 'Has this student been observed to be detached from reality and living in an imaginative world? (e.g., talking to or hearing voices of imaginary friends that is not make-believe play).' },
                    { id: '14.10', text: '*Does this student have drastic changes in behaviour or personality, for example, fighting frequently, using weapons, and or expressing a desire to hurt himself/herself or others?' }
                ],
                'Multiple Sclerosis (MS)': [
                    { id: '15.3', text: '*Does this student get tremors (rhythmic, muscle contraction and relaxation)?' },
                    { id: '15.4', text: 'Does this student exhibit partial or complete loss of vision, usually in one eye at a time?' },
                    { id: '15.5', text: 'Does this student have blurry and unclear vision?' },
                    { id: '15.6', text: '*Does this student have slurred speech? (characterized by poor pronunciation of words, mumbling, or a change in speed or rhythm during talking).' },
                    { id: '15.7', text: 'Does this student get easily tired or fatigued?' },
                    { id: '15.8', text: 'Does this student complain about pins-and-needles sensation especially in the face, arms, legs and fingers?' }
                ],
                "Parkinson's Disease": [
                    { id: '16.2', text: '*Does this student have tremors or shaking that usually begins in a limb, often hand or finger?' }
                ],
                'Haemophilia': [
                    { id: '17.6', text: '*Does this student have unusual bleeding after vaccinations?' },
                    { id: '17.7', text: 'Does this student have pain, swelling or tightness in joints?' },
                    { id: '17.8', text: 'Does this student vomit repeatedly?' }
                ],
                'Thalassemia': [
                    { id: '18.6', text: '*Is this student frequently absent and visit the hospital for blood transfusion?' }
                ]
            }
        };

        // Generate assessment items
        function generateAssessmentItems() {
            const part1Container = document.getElementById('part1-assessments');
            const part2Container = document.getElementById('part2-assessments');

            // Generate Part 1 items
            Object.entries(assessmentData.part1).forEach(([category, items]) => {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'mb-8';
                categoryDiv.innerHTML = `
                    <h3 class="text-lg font-semibold text-purple-800 mb-4 pb-2 border-b-2 border-purple-200">
                        ${category}
                    </h3>
                    <div class="space-y-4">
                        ${items.map(item => createAssessmentItem(item, category, 'part1')).join('')}
                    </div>
                `;
                part1Container.appendChild(categoryDiv);
            });

            // Generate Part 2 items
            Object.entries(assessmentData.part2).forEach(([category, items]) => {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'mb-8';
                categoryDiv.innerHTML = `
                    <h3 class="text-lg font-semibold text-purple-800 mb-4 pb-2 border-b-2 border-purple-200">
                        ${category} (Additional)
                    </h3>
                    <div class="space-y-4">
                        ${items.map(item => createAssessmentItem(item, category, 'part2')).join('')}
                    </div>
                `;
                part2Container.appendChild(categoryDiv);
            });
        }

        function createAssessmentItem(item, category, part) {
            const isSpecial = item.text.startsWith('*');
            const itemId = `${part}-${item.id.replace('.', '-')}`;
            
            return `
                <div class="assessment-item bg-gray-50 p-4 rounded-lg border ${isSpecial ? 'border-red-300 bg-red-50' : 'border-gray-200'}">
                    <div class="flex items-start space-x-4">
                        <div class="flex-shrink-0">
                            <span class="inline-flex items-center justify-center w-8 h-8 rounded-full ${isSpecial ? 'bg-red-100 text-red-800' : 'bg-blue-100 text-blue-800'} text-sm font-semibold">
                                ${item.id}
                            </span>
                        </div>
                        <div class="flex-1">
                            <p class="text-gray-800 mb-3 ${isSpecial ? 'font-medium' : ''}">${item.text}</p>
                            ${isSpecial ? '<p class="text-red-600 text-xs mb-2"><i class="fas fa-exclamation-triangle mr-1"></i>Requires special attention/professional consultation</p>' : ''}
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Response</label>
                                    <div class="flex space-x-4">
                                        <label class="inline-flex items-center">
                                            <input type="radio" name="${itemId}-response" value="yes" class="form-radio text-green-600" onchange="updateProgress()">
                                            <span class="ml-2 text-green-600">✓ Yes</span>
                                        </label>
                                        <label class="inline-flex items-center">
                                            <input type="radio" name="${itemId}-response" value="no" class="form-radio text-red-600" onchange="updateProgress()">
                                            <span class="ml-2 text-red-600">✗ No</span>
                                        </label>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Notes/Comments</label>
                                    <textarea name="${itemId}-notes" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm" placeholder="Additional observations..."></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function updateProgress() {
            const totalItems = getTotalAssessmentItems();
            const completedItems = getCompletedAssessmentItems();
            const percentage = Math.round((completedItems / totalItems) * 100);
            
            document.getElementById('progress-count').textContent = completedItems;
            document.getElementById('progress-bar').style.width = `${percentage}%`;
        }

        function getTotalAssessmentItems() {
            let total = 0;
            Object.values(assessmentData.part1).forEach(items => total += items.length);
            Object.values(assessmentData.part2).forEach(items => total += items.length);
            return total;
        }

        function getCompletedAssessmentItems() {
            const form = document.getElementById('prashast-form');
            const radioInputs = form.querySelectorAll('input[type="radio"]:checked');
            return radioInputs.length;
        }

        function collectAssessmentData() {
            const responses = [];
            
            // Collect Part 1 responses
            Object.entries(assessmentData.part1).forEach(([category, items]) => {
                items.forEach(item => {
                    const itemId = `part1-${item.id.replace('.', '-')}`;
                    const responseElement = document.querySelector(`input[name="${itemId}-response"]:checked`);
                    const notesElement = document.querySelector(`textarea[name="${itemId}-notes"]`);
                    
                    if (responseElement) {
                        responses.push({
                            itemNo: item.id,
                            condition: category,
                            item: item.text,
                            response: responseElement.value === 'yes' ? '✓' : '✗',
                            notes: notesElement ? notesElement.value : '',
                            part: 'Part-1'
                        });
                    }
                });
            });

            // Collect Part 2 responses
            Object.entries(assessmentData.part2).forEach(([category, items]) => {
                items.forEach(item => {
                    const itemId = `part2-${item.id.replace('.', '-')}`;
                    const responseElement = document.querySelector(`input[name="${itemId}-response"]:checked`);
                    const notesElement = document.querySelector(`textarea[name="${itemId}-notes"]`);
                    
                    if (responseElement) {
                        responses.push({
                            itemNo: item.id,
                            condition: category,
                            item: item.text,
                            response: responseElement.value === 'yes' ? '✓' : '✗',
                            notes: notesElement ? notesElement.value : '',
                            part: 'Part-2'
                        });
                    }
                });
            });

            return responses;
        }

        function saveProgress() {
            const formData = new FormData(document.getElementById('prashast-form'));
            const data = {};
            
            for (let [key, value] of formData.entries()) {
                data[key] = value;
            }
            
            // Also save input values
            const inputs = document.querySelectorAll('#prashast-form input, #prashast-form select, #prashast-form textarea');
            inputs.forEach(input => {
                if (input.type === 'radio') {
                    if (input.checked) {
                        data[input.name] = input.value;
                    }
                } else {
                    data[input.id || input.name] = input.value;
                }
            });
            
            localStorage.setItem('prashast-progress', JSON.stringify(data));
            alert('Progress saved successfully!');
        }

        function loadProgress() {
            const savedData = localStorage.getItem('prashast-progress');
            if (!savedData) {
                alert('No saved progress found.');
                return;
            }
            
            try {
                const data = JSON.parse(savedData);
                
                // Restore input values
                Object.entries(data).forEach(([key, value]) => {
                    const element = document.getElementById(key) || document.querySelector(`[name="${key}"]`);
                    if (element) {
                        if (element.type === 'radio') {
                            const radioButton = document.querySelector(`input[name="${key}"][value="${value}"]`);
                            if (radioButton) {
                                radioButton.checked = true;
                            }
                        } else {
                            element.value = value;
                        }
                    }
                });
                
                updateProgress();
                alert('Progress loaded successfully!');
            } catch (error) {
                alert('Error loading progress: ' + error.message);
            }
        }

        async function submitAssessment() {
            const loadingModal = document.getElementById('loading-modal');
            
            try {
                // Show loading modal
                loadingModal.classList.remove('hidden');
                loadingModal.classList.add('flex');
                
                // Collect form data
                const studentInfo = {
                    name: document.getElementById('student-name').value,
                    class: document.getElementById('student-class').value,
                    section: document.getElementById('student-section').value,
                    age: document.getElementById('student-age').value,
                    gender: document.getElementById('student-gender').value,
                    school: document.getElementById('student-school').value,
                    state: document.getElementById('student-state').value,
                    motherName: document.getElementById('mother-name').value,
                    fatherName: document.getElementById('father-name').value,
                    height: document.getElementById('student-height').value,
                    weight: document.getElementById('student-weight').value
                };
                
                const assessorName = document.getElementById('assessor-name').value;
                const responses = collectAssessmentData();
                
                // Validate required fields
                if (!studentInfo.name || !studentInfo.class || !studentInfo.section || !studentInfo.age || !studentInfo.gender || !studentInfo.school || !studentInfo.state || !assessorName) {
                    throw new Error('Please fill in all required fields marked with *');
                }
                
                if (responses.length === 0) {
                    throw new Error('Please complete at least one assessment item before submitting.');
                }
                
                // Prepare data for Google Sheets
                const submissionData = {
                    studentInfo: studentInfo,
                    responses: responses,
                    assessorName: assessorName,
                    timestamp: new Date().toISOString()
                };
                
                // Submit to Google Sheets
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(submissionData)
                });
                
                // Hide loading modal
                loadingModal.classList.add('hidden');
                loadingModal.classList.remove('flex');
                
                // Show success message
                alert(`Assessment submitted successfully!\n\nStudent: ${studentInfo.name}\nItems completed: ${responses.length}\nAssessor: ${assessorName}\n\nData has been saved to Google Sheets.`);
                
                // Clear form
                if (confirm('Would you like to clear the form for the next assessment?')) {
                    document.getElementById('prashast-form').reset();
                    updateProgress();
                    localStorage.removeItem('prashast-progress');
                }
                
            } catch (error) {
                // Hide loading modal
                loadingModal.classList.add('hidden');
                loadingModal.classList.remove('flex');
                
                alert('Error submitting assessment: ' + error.message);
                console.error('Submission error:', error);
            }
        }

        // Form submission handler
        document.getElementById('prashast-form').addEventListener('submit', function(e) {
            e.preventDefault();
            submitAssessment();
        });

        // Initialize the form
        document.addEventListener('DOMContentLoaded', function() {
            generateAssessmentItems();
            updateProgress();
            
            // Auto-save progress periodically
            setInterval(() => {
                if (getCompletedAssessmentItems() > 0) {
                    saveProgress();
                }
            }, 300000); // Auto-save every 5 minutes
        });
    </script>
</body>
</html>
